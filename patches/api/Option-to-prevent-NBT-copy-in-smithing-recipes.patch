From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Potrebic <jake.m.potrebic@gmail.com>
Date: Sun, 26 Sep 2021 12:57:35 -0700
Subject: [PATCH] Option to prevent NBT copy in smithing recipes


diff --git a/src/main/java/org/bukkit/inventory/SmithingRecipe.java b/src/main/java/org/bukkit/inventory/SmithingRecipe.java
index 0000000000000000000000000000000000000000..0000000000000000000000000000000000000000 100644
--- a/src/main/java/org/bukkit/inventory/SmithingRecipe.java
+++ b/src/main/java/org/bukkit/inventory/SmithingRecipe.java
@@ -0,0 +0,0 @@ public class SmithingRecipe implements Recipe, Keyed {
     private final ItemStack result;
     private final RecipeChoice base;
     private final RecipeChoice addition;
+    private final boolean copyNbt; // Paper
 
     /**
      * Create a smithing recipe to produce the specified result ItemStack.
@@ -0,0 +0,0 @@ public class SmithingRecipe implements Recipe, Keyed {
      * @param addition The addition ingredient
      */
     public SmithingRecipe(@NotNull NamespacedKey key, @NotNull ItemStack result, @NotNull RecipeChoice base, @NotNull RecipeChoice addition) {
+        // Paper start
+        this(key, result, base, addition, true);
+    }
+    /**
+     * Create a smithing recipe to produce the specified result ItemStack.
+     *
+     * @param key The unique recipe key
+     * @param result The item you want the recipe to create.
+     * @param base The base ingredient
+     * @param addition The addition ingredient
+     * @param copyNbt whether to copy the nbt from the input base item to the output
+     */
+    public SmithingRecipe(@NotNull NamespacedKey key, @NotNull ItemStack result, @NotNull RecipeChoice base, @NotNull RecipeChoice addition, boolean copyNbt) {
+        this.copyNbt = copyNbt;
+        // Paper end
         this.key = key;
         this.result = result;
         this.base = base;
@@ -0,0 +0,0 @@ public class SmithingRecipe implements Recipe, Keyed {
     public NamespacedKey getKey() {
         return this.key;
     }
+
+    // Paper start
+    /**
+     * Whether or not to copy the NBT of the input base item to the output.
+     *
+     * @return true to copy the NBT (default for vanilla smithing recipes)
+     */
+    public boolean willCopyNbt() {
+        return copyNbt;
+    }
+    // Paper end
 }
diff --git a/src/main/java/org/bukkit/inventory/SmithingTransformRecipe.java b/src/main/java/org/bukkit/inventory/SmithingTransformRecipe.java
index 0000000000000000000000000000000000000000..0000000000000000000000000000000000000000 100644
--- a/src/main/java/org/bukkit/inventory/SmithingTransformRecipe.java
+++ b/src/main/java/org/bukkit/inventory/SmithingTransformRecipe.java
@@ -0,0 +0,0 @@ public class SmithingTransformRecipe extends SmithingRecipe {
         super(key, result, base, addition);
         this.template = template;
     }
+    // Paper start
+    /**
+     * Create a smithing recipe to produce the specified result ItemStack.
+     *
+     * @param key The unique recipe key
+     * @param result The item you want the recipe to create.
+     * @param template The template item.
+     * @param base The base ingredient
+     * @param addition The addition ingredient
+     * @param copyNbt whether to copy the nbt from the input base item to the output
+     */
+    public SmithingTransformRecipe(@NotNull NamespacedKey key, @NotNull ItemStack result, @NotNull RecipeChoice template, @NotNull RecipeChoice base, @NotNull RecipeChoice addition, boolean copyNbt) {
+        super(key, result, base, addition, copyNbt);
+        this.template = template;
+    }
+    // Paper end
 
     /**
      * Get the template recipe item.
diff --git a/src/main/java/org/bukkit/inventory/SmithingTrimRecipe.java b/src/main/java/org/bukkit/inventory/SmithingTrimRecipe.java
index 0000000000000000000000000000000000000000..0000000000000000000000000000000000000000 100644
--- a/src/main/java/org/bukkit/inventory/SmithingTrimRecipe.java
+++ b/src/main/java/org/bukkit/inventory/SmithingTrimRecipe.java
@@ -0,0 +0,0 @@ public class SmithingTrimRecipe extends SmithingRecipe implements ComplexRecipe
         super(key, new ItemStack(Material.AIR), base, addition);
         this.template = template;
     }
+    // Paper start
+    /**
+     * Create a smithing recipe to produce the specified result ItemStack.
+     *
+     * @param key The unique recipe key
+     * @param template The template item.
+     * @param base The base ingredient
+     * @param addition The addition ingredient
+     * @param copyNbt whether to copy the nbt from the input base item to the output
+     */
+    public SmithingTrimRecipe(@NotNull NamespacedKey key, @NotNull RecipeChoice template, @NotNull RecipeChoice base, @NotNull RecipeChoice addition, boolean copyNbt) {
+        super(key, new ItemStack(Material.AIR), base, addition, copyNbt);
+        this.template = template;
+    }
+    // Paper end
 
     /**
      * Get the template recipe item.
